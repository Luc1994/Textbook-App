package com.parse.starter;

import android.app.Activity;
import android.app.AlertDialog;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;

import com.parse.Parse;
import com.parse.ParseACL;
import com.parse.ParseAnalytics;
import com.parse.ParseException;
import com.parse.ParseObject;
import com.parse.ParseQuery;
import com.parse.ParseUser;
import android.widget.EditText;

import android.app.AlertDialog;

public class ParseStarterProjectActivity extends Activity {
	/** Called when the activity is first created. */
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.main);
		
		// Add your initialization code here
	    Parse.initialize(this, "imNR8maOdk7pX3UOCTT67BRt58azQVw91e9vtdbl", "tYAaTCZ7f6SMkS1aAGSCBn7XkN7goCx7dTY0z1sY");
	    // Also, specify a default Activity to handle push notifications in this method as well

	    ParseUser.enableAutomaticUser();
	    ParseACL defaultACL = new ParseACL();
	      
	    // If you would like all objects to be private by default, remove this line.
	    defaultACL.setPublicReadAccess(true);
	    
	    ParseACL.setDefaultACL(defaultACL, true);
		
		ParseAnalytics.trackAppOpened(getIntent());
		
		Button confirmation = (Button) findViewById(R.id.confirm);

		confirmation.setOnClickListener(new OnClickListener()
		{
			@Override
			public void onClick(View v)
			{
				String bookTitle = ((EditText)findViewById(R.id.enterTitle)).getText().toString();
				String bookAuthor = ((EditText)findViewById(R.id.enterAuthor)).getText().toString();
				String bookLowPrice = ((EditText)findViewById(R.id.enterPrice)).getText().toString();
				//String bookHighPrice = ((EditText)findViewById(R.id.enterHighPrice)).getText().toString();
				new AlertDialog.Builder(ParseStarterProjectActivity.this)
				.setMessage(bookTitle + " " + bookAuthor + " " + bookLowPrice).create().show();
				sendToCloud(bookTitle, bookAuthor, bookLowPrice);
			}
		});
		
	}
	
	public int priceRangeLowerBound (String priceRange) {
		if (priceRange.indexOf("-") != -1 && priceRange.indexOf(" ") == -1) {
			int lowerBound = Integer.parseInt(priceRange.substring(0, priceRange.indexOf("-")));
			return lowerBound;
		}
		else if (priceRange.indexOf("-") == -1 && priceRange.indexOf(" ") != -1) {
			int lowerBound = Integer.parseInt(priceRange.substring(0, priceRange.indexOf(" ")));
			return lowerBound;
		}
		else {
			if (priceRange.indexOf("-") < priceRange.indexOf(" ")) {
				int lowerBound = Integer.parseInt(priceRange.substring(0, priceRange.indexOf("-")));
				return lowerBound;
			}
			else {
				int lowerBound = Integer.parseInt(priceRange.substring(0, priceRange.indexOf(" ")));
				return lowerBound;
			}
		}
		
	}
	
	public int priceRangeUpperBound (String priceRange) {
		//this code is rudimentary and doesn't account for the possibility of multiple spaces or dashes
		if (priceRange.indexOf("-") != -1 && priceRange.indexOf(" ") == -1) {
			int upperBound = Integer.parseInt(priceRange.substring(priceRange.indexOf("-") + 1, priceRange.length()));
			return upperBound;
		}
		else if (priceRange.indexOf("-") == -1 && priceRange.indexOf(" ") != -1) {
			int upperBound = Integer.parseInt(priceRange.substring(priceRange.indexOf(" ") + 1, priceRange.length()));
			return upperBound;
		}
		else {
			if (priceRange.indexOf("-") < priceRange.indexOf(" ")) {
				int upperBound = Integer.parseInt(priceRange.substring(priceRange.indexOf("-") + 1, priceRange.length()));
				return upperBound;
			}
			else {
				int upperBound = Integer.parseInt(priceRange.substring(priceRange.indexOf(" "), priceRange.length()));
				return upperBound;
			}
		}
	}
	
	public void sendToCloud (String title, String author, String lowPrice) {
		ParseObject textbook = new ParseObject("SampleTextbook");
		textbook.put("Title", title.toLowerCase());
		textbook.put("Author", author.toLowerCase());
		textbook.put("LowPrice", Integer.parseInt(lowPrice));
		try {
			textbook.save();
		} catch (ParseException e) {
			// TODO Auto-generated catch block
			throw new RuntimeException(e);
		}
		String objectId = textbook.getObjectId();
	}

}
